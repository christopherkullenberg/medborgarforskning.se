{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load projects_extras %}
{% block content %}
{% load keyword_for_all_extras %}





<h1>Kom igång med medborgarforskning</h1>


<p>För att ditt projekt ska bli synligt i hela Europa använder vi EU-Citizen Sciences
databas. När du lägger upp ditt projekt på EU-Citizen Sciences plattform blir projektet
synligt även på medborgarforskning.se.</p>
<br>
<p>
Klicka på <a href="https://eu-citizen.science/login/">https://eu-citizen.science/login/</a>
för att skapa ett konto hos EU-Citizen Science
  </p>










{% endblock content %}






<!--- The old submission system is below. Just move down  endblock content and it will work -->

<!--
{% if user.is_authenticated %}





<script type="text/javascript">





  function add_keyword_input_line(sv, en) {

    if( count < 10){

      count += 1
      var new_keyword_line =  $("#hidden_keyword_div" ).clone();
      new_keyword_line.attr("id", "keyword_div_" + count)
      new_keyword_line.find("#hidden_input_eng").attr({"name": "Keyword_eng_" + count, "value" : en })
      new_keyword_line.find("#hidden_input_sve").attr({"name": "Keyword_sve_" + count, "value" : sv })
      new_keyword_line.find("#hidden_row_number").html( count)
      new_keyword_line.appendTo( "#keyword_div" );
    }


  }
  function remove_keyword_input_line(){
    if(count > 0){
      $("#keyword_div_" + count ).remove();
      count -= 1
    }
  }

</script>

<form  method='post' enctype="multipart/form-data">
  {% csrf_token %}
  <div class="custom-container">

    <ul class="nav nav-tabs">

      <li class="nav-item">
        <a class="nav-link active disabled" data-toggle="tab" href="#step1">{% trans "Details" %}</a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" data-toggle="tab" href="#step_aim">{% trans "Aim" %} <span class="glyphicon glyphicon-align-left" ></span></a>
      </li>
      <li class="nav-item ">
        <a class="nav-link disabled" data-toggle="tab" href="#step_description">{% trans "Description" %}</a>
      </li>

      <li class="nav-item">
        <a class="nav-link disabled" data-toggle="tab" href="#step3">{% trans "Keywords" %}</a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" data-toggle="tab" href="#step4">{% trans "Card view" %}</a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" data-toggle="tab" href="#step5">{% trans "Contact info" %}</a>


      </li>





        <button class="nav-item  btn-danger form-control col-6 col-sm-4 col-md-2" type="button" onclick="prevnav()" style="margin: 10px; padding: 5px;">< {% trans "Previous" %} </button>




        <button class="nav-item  btn-success form-control col-6 col-sm-4 col-md-2" type="button" onclick="nextnav()" style="margin: 10px; padding: 5px;"> {% trans "Next" %} > </button>



    </ul>


    <div class="tab-content">


      <br>



      <div id="step1" class="tab-pane container active">


        <h3 align="center"> {% trans "Project details" %}  </h3>
        <br>
        <br>


        <p>{% trans "Your account and email will be associated with this submission for follow-up." %}</p>

        <div align="center" class="row">

          <div class="col-3">
            <h4>
              {% trans "Title" %}
            </h4>

            {{ Submission.name }}
          </div>



          <div class="col-3">

            <h4>
              {% trans "Image" %}


            </h4>
            {{ Submission.image }}

          </div>

          <div class="col-3">

            <h4>
              {% trans "Status" %}

            </h4>

            {{ Submission.status }}
            <br>



          </div>


          <div class="col-3">
            <h4>
              {% trans "Target audience" %}
            </h4>

            {{ Submission.target_audience }}

          </div>

          <div class="col-3">
            <h4>
              {% trans "Science type" %}
            </h4>

            {{ Submission.science_type }}

          </div>



        </div>

        <br>
        <br>

      </div>
      <div class="tab-pane container fade" id="step_aim">
        <div class="col-12">

          <h3 align="center"> {% trans "Enter project aim" %}</h3>
          <br>
          <br>
          <h6 align="center"> {% trans "What is the purpose of this project?" %}</h6>

       </div>

       {{ Submission.aim }}
     </div>
     <div class="tab-pane container fade" id="step_description">
      <div class="col-12">

        <h3 align="center"> {% trans "Enter project description" %} </h3>



      </div>

      <br><br>

      {{ Submission.description }}

      <hr>
      <br>

    </div>

    <div id="step3" class="tab-pane fade">



                <datalist id="eng">
                {% for kw in "eng"|get_keywords %}
                    <option value="{{ kw }}"></option>
                {% endfor %}
            </datalist>

            <datalist id="swe">
                {% for kw in "swe"|get_keywords %}
                    <option value="{{ kw }}"></option>
                {% endfor %}
            </datalist>

      <div class="col-xxl-5   col-xl-9   col-lg-12 col-md-12 col-sm-12 col-12">

        <h3 align="center" class="">
        {% trans "Keywords" %}
      </h3>
      <br>
      <br>

          <h5 align="center">
             {% trans "Add keywords, preferably with a translation in the corresponding field on the same line" %}
       <h5>
        <br>

        <div class="row">

          <div class="col-0 col-sm-2 col-lg-4 col-md-4 "></div>
          <div class="col-12 col-sm-8 col-md-6 col-lg-5 ">

            <div class="row">
              <button type="button" onclick="add_keyword_input_line()" class="col-6 form-control" style="height: 60px; background: MediumSeaGreen; color: white;"> <h4>{% trans "Add" %} </h4> </button>
              <button type="button" onclick="remove_keyword_input_line()" class="col-6 form-control" style="height: 60px; background: IndianRed; color: white;"> <h4>{% trans "Remove" %}</h4></button>
            </div>


          </div>
          <div class="col-4"></div>

        </div>


        <br>        <br>








        <div class="row">
          <div class="col-1"></div>
          <div class="col-5"><h3 align="center"> {% trans "Swedish" %}</h3></div>
          <div class="col-1">  </div>
          <div class="col-5"><h3 align="center"> {% trans "English" %}</h3></div>
        </div>

        <hr>


        <div id="keyword_div">


        </div>

      </div>

    </div>



    <div id="step4" class="tab-pane fade">




      <h3 align="center"> {% trans "Card view" %}</h3>
<br>
<br>

      <div class="row">


        <div class="col-6 col-lg-3 col-md-4 col-xs-6 mb-5">

          <div class="col">

            <h4> {% trans "Short Name" %} </h4>

            <div class="col-12">
              {{ Submission.name_card}}
            </div>

          </div>




          <div class="col">

            <h4> {% trans "Short aim" %} </h4>
            <div class="col-12">
              {{ Submission.aim_card}}
            </div>

          </div>





          <div class="col">

            <h4>{% trans "Short description" %}</h4>
            <div class="col-12">
              {{ Submission.description_card}}
            </div>

          </div>



        </div>




        <div style="padding-left: 20px; padding-right: 20px" class="col-lg-3 col-md-4 col-xs-6 mb-5">
          <div class="project-item">
            <div class="row">
              <div class=" col">
                <div  class="col project-items-justify blackFieldWhiteText">
                  <h4 align="center" style="color: white; font-size: 16px" id="rep_card_name"> </h4>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col">
                <img class="mg-fluid w-100" id="card_img" src="{{ inital_image}}" />
              </div>

            </div>
            <div class="col" style="padding-right: 5px; padding-left: 5px; margin-top: 3px">
              <div class="row Lato-font ">
                <div class="col" >
                  <span >{% trans "Aim" %}: </span> <span id="rep_card_aim" ></span>
                </div>
              </div>
              <hr>
              <div class="row Lato-font">

                <div class="col">
                  <span > {% trans "Description" %}: </span> <span id="rep_card_description"></span>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>

    </div>

    <div id="step5" class="tab-pane fade">


      <h3 align="center"> {% trans "Contact info" %} </h3>
      <br><br>

      <h5>
        {% trans "your email will not be publicly visible" %}
      </h5>

      <br><br>

      <div class="row">

        <div class="col-3">
          <h4>{% trans Submission.contact_name.label %}</h4>
          {{ Submission.contact_name }}
        </div>


        <div class="col-3">
          <h4>{% trans Submission.contact_email.label %}</h4>
          {{ Submission.contact_email }}
        </div>


        <div class="col-3">
          <h4>{% trans Submission.contact_role.label %}</h4>
          {{ Submission.contact_role }}
        </div>


        <div class="col-3">
          <h4>{% trans Submission.contact_affiliation.label %}</h4>
          {{ Submission.contact_affiliation }}
        </div>

        <div class="col-3">
          <h4>{% trans Submission.url.label %}</h4>
          {{ Submission.url }}
        </div>

      </div>
      <br>


      <button class="form-control col-4 btn-success" type='submit' value='Save'>
       {% trans "Submit Project to ARCS" %}
     </button> <!-- TODO replace with django template for  -->






    </div>





      <div style="display: none;">
          <div id="hidden_keyword_div" class="row" style="border-bottom: 1px solid black">

              <div class="col-1"><span id="hidden_row_number"></span></div>

              <div class="col-5">
                  <input id="hidden_input_sve" autocomplete="off" list="swe"
                         class="form-control trans-option">
              </div>
              <div class="col-1"><h1 align="center">=</h1></div>
              <div class="col-5">
                  <input id="hidden_input_eng" autocomplete="off" list="eng"
                         class="form-control trans-option">

              </div>
          </div>
      </div>

    </form>

              <script type="text/javascript">
                function trans_resiver(string) {
                    if (string.slice(-3,) == "swe") {
                        return "eng";
                    };
                    if (string.slice(-3,) == "eng") {
                        return "swe";
                    };
                    return "";
                }
                $(document).ready(function () {
                    var id_count = 0;
                    var sender_input;
                    //var sender_lang;
                    $(document).on("change", '.trans-option', function () {
                        $(this).val($(this).val().trim().replace(/[^a-zA-Z0-9ä-öÄ-Ö().&: -]/g, ""));
                        if ($(this).val().length == 0) {
                            $(this).parent().parent().find(":input:not([id=" + $(this).attr("id") + "])").attr("list", trans_resiver($(this).attr("id")));
                            console.log("stop at input");
                            return;
                        }
                        if ($(this).attr("list").length != 3) {
                            console.log("stop at list")
                            return;
                        };
                        if ($(this).attr("list") == "swe") {
                            var input_string = "#hidden_input_eng";
                        } else if ($(this).attr("list") == "eng") {
                            var input_string = "#hidden_input_swe";
                        };
                        sender_input = $(this).parent().parent().find(":input:not([id=" + $(this).attr("id") + "])");
                        if ($('#' + $(this).attr("list") + ' option[value="' + $(this).val() + '"]').length == 0) {
                            console.log("stop at option")
                            return;
                        };


                        var value_lang_string = "#" + $(this).attr("id").slice(-3,) + "_" + $(this).val().replace(/ /g, "_");

                        if ($("#opt-trans " + value_lang_string).length > 0) {
                            var this_dtl = $("#opt-trans " + value_lang_string).children();
                            if (this_dtl.length == 1) {
                                sender_input.val(this_dtl.first().val());
                            } else {
                                sender_input.attr("list", $(this).attr("id").slice(-3,) + "_" + $(this).val());
                            };
                            console.log("stop at rev");
                            return;
                        };
                        var this_value = $(this).val();
                        console.log("ajax")
                        $.ajax({
                            type: "GET",
                            url: "{% url 'workpackages:ajax_get_trans' %}",
                            data: {"lang": $(this).attr("list"), "kw": $(this).val()},
                            success: function (data) {
                                var dtl = document.getElementById("opt-trans").appendChild(document.createElement('datalist'));
                                var id_string = trans_resiver(sender_input.attr("id")) + "_" + this_value.replace(/ /g, "_");
                                id_count += 1;
                                dtl.id = id_string;
                                $(sender_input).attr('list', id_string);
                                var opt = "";
                                for (var i = 0; i < data.trans.length; i++) {
                                    opt += "<option value='" + data.trans[i] + "' />";
                                };
                                if (data.trans.length == 1) {
                                    sender_input.val(data.trans[0]);
                                }
                                dtl.innerHTML = opt;
                                sender_input.select();
                            }
                        });
                    });
                });
            </script>
            <div id="opt-trans">
            </div>



    {% else %}
    <p>{% trans "Plese sign in or create an account to add a project." %}</p>
    <p>{% trans "To submit a project you'll be asked to provide the following information." %}</p>
    <ul>
      <li>{% trans "A common name for identifying the project." %}</li>
      <li>{% trans "A brief description of the project." %}</li>
      <li>{% trans "The aim of the project." %}</li>
      <li>{% trans "The status of the projet ie if it is active or historical." %}</li>
      <li>{% trans "The target audience of the project." %}</li>
      <li>{% trans "Your affiliation to the project as the person submitting the project." %}</li>
      <li>{% trans "Keywords for the project." %}</li>
    </ul>
    <p>{% trans "Following submission your project will be reviewed before becoming visibile on the site and included in the metadata exchange. Review the citizen science assessment criteria for visiblity and exchange." %}</p>
    {% endif %}




  </div>

</div>






</div>



{% if keyword_len  %}

<script type="text/javascript">

  var count = 0



</script>


{% for line in keyword_line %}

<script type="text/javascript">
  add_keyword_input_line("{{line.0}}", "{{line.1}}")
</script>

{% endfor %}




{% else %}

<script type="text/javascript">

  var count = 0

  add_keyword_input_line()



</script>

{% endif %}


<script type="text/javascript">




 $("#id_name").change({name: "name"}, change_card_passive);
 $("#id_name_card").change({name: "name"}, change_card_dominant);

 $("#id_aim").change({name: "aim"}, change_card_passive);
 $("#id_aim_card").change({name: "aim"}, change_card_dominant);

 $("#id_description").change({name: "description"}, change_card_passive);
 $("#id_description_card").change({name: "description"}, change_card_dominant);




 function change_card_dominant(event){

  if(this.value.replace(/\s/g, "").length == 0 ){
    $("#rep_card_" + event.data.name ).html($("#id_"+ event.data.name).val());
  }

  else{

    $("#rep_card_" + event.data.name ).html(this.value);

  }


};

function change_card_passive(event){

  if( $("#id_" + event.data.name + "_card").val().replace(/\s/g, "").length == 0 ){

    $("#rep_card_" + event.data.name ).html(this.value);

  }

};


var secClicked = true;



function nextnav(){





  if (secClicked == true){

    var current_a_tag = $(".nav-tabs").find(".active");
    var go_to_next = true;


    $(current_a_tag.attr("href")).find("input").each(function(){
      if($(this).prop('required')){
        if(this.value.replace(/\s/g, "").length == 0){

          go_to_next = false;


          $(this).css("border", "solid red 1px")
        }
        else{
          $(this).css("border", "solid MediumSeaGreen 1px");
        };
      }

    });

    if(current_a_tag.attr("href") == "#step_aim"){

      if($('#id_aim').val().length < 30   ){
        var go_to_next = false;

      }

    }

    if(current_a_tag.attr("href") == "#step_description"){

      if($('#id_description').val().length < 30   ){
        var go_to_next = false;

      }

    }







    if(go_to_next == true){

      'current_a_tag.addClass("disabled");'

      current_a_tag.parent().css("background", "MediumSeaGreen");
      current_a_tag.parent().next().find('a').removeClass('disabled').trigger('click').addClass("disabled");

    }
    else{
      current_a_tag.parent().css("background", "IndianRed");
    }

    secClicked = false;

    setTimeout(function() {
      secClicked = true;
    }, 200);

  }




};

function prevnav(){

  if (secClicked == true){

    var current_a_tag = $(".nav-tabs").find(".active");
    current_a_tag.parent().css("background", "");



    current_a_tag.parent().prev().find('a').removeClass('disabled').trigger('click').addClass("disabled");

    secClicked = false;

    setTimeout(function() {
      secClicked = true;
    }, 200);



  }

}

function readURL() {


  if (this.files && this.files[0]) {
    var reader = new FileReader();

    reader.onload = function (e) {
      $('#card_img')
      .attr('src', e.target.result)
      .width(150)
      .height(200);
    };

    reader.readAsDataURL(this.files[0]);
  }
}

$("#id_image").change(readURL)
$("#id_name_card").change()
$("#id_image").change()
$("#id_aim_card").change()
$("#id_description_card").change()

</script>
-->
